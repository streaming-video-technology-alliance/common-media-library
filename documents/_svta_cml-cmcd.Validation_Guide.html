<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Validation Guide | CML</title><link rel="icon" href="../assets/favicon.png" type="image/png"/><meta name="description" content="Documentation for CML"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">CML</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="../modules/_svta_cml-cmcd.html">@svta/cml-cmcd</a></li><li><a href="" aria-current="page">Validation Guide</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="cmcd-validation-guide" class="tsd-anchor-link">CMCD Validation Guide<a href="#cmcd-validation-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>@svta/cml-cmcd</code> library provides a set of composable validation functions for verifying that CMCD payloads conform to the CTA-5004 (v1) and CTA-5004-A (v2) specifications. These are useful for validating payloads on the receiving end — for example, in an analytics server that collects CMCD event reports, or in a CDN log processor that inspects CMCD request data.</p>
<h2 id="overview" class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>There are three main validation functions, each targeting a different aspect of CMCD compliance:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>validateCmcd</code></td>
<td>Orchestrator — runs key, value, and structure checks</td>
</tr>
<tr>
<td><code>validateCmcdRequest</code></td>
<td>Validates a <code>Request</code> or <code>HttpRequest</code> as request-mode data</td>
</tr>
<tr>
<td><code>validateCmcdEvents</code></td>
<td>Validates a multi-line <code>text/cmcd</code> body as event-mode data</td>
</tr>
</tbody>
</table>
<p>All validators return a <code>CmcdValidationResult</code>:</p>
<pre><code class="typescript"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-9">CmcdValidationResult</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-4">valid</span><span class="hl-1">: </span><span class="hl-9">boolean</span><span class="hl-1">; </span><span class="hl-8">// true if zero errors (warnings are OK)</span><br/><span class="hl-1">	</span><span class="hl-4">issues</span><span class="hl-1">: </span><span class="hl-9">CmcdValidationIssue</span><span class="hl-1">[];</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-9">CmcdValidationIssue</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-4">key</span><span class="hl-1">?: </span><span class="hl-9">string</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-4">message</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-4">severity</span><span class="hl-1">: </span><span class="hl-9">CmcdValidationSeverity</span><span class="hl-1">; </span><span class="hl-8">// &#39;error&#39; | &#39;warning&#39;</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<h2 id="validating-event-report-payloads" class="tsd-anchor-link">Validating Event Report Payloads<a href="#validating-event-report-payloads" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>A common use case is validating CMCD v2 event reports received via POST. The payload is typically a <code>text/cmcd</code> body containing newline-separated CMCD-encoded strings, or <code>application/json</code>.</p>
<h3 id="using" class="tsd-anchor-link">Using <code>validateCmcdEvents</code><a href="#using" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>validateCmcdEvents</code> function accepts a raw CMCD string and validates it as an event-mode payload. It supports multi-line <code>text/cmcd</code> bodies directly — each non-empty line is validated independently and the results are merged. An empty payload (no non-empty lines) is treated as an error.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcdEvents</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Validate a complete text/cmcd POST body</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">body</span><span class="hl-1"> = </span><span class="hl-2">`e=ps,sid=&quot;session-1&quot;,ts=1700000000000,sta=p,v=2</span><br/><span class="hl-2">e=t,sid=&quot;session-1&quot;,ts=1700000001000,bl=(5000),v=2`</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdEvents</span><span class="hl-1">(</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">valid</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Invalid CMCD event:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">issues</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>A single-line string works as well:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcdEvents</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdEvents</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-2">&#39;e=ps,sid=&quot;session-1&quot;,ts=1700000000000,sta=p,v=2&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="parsing-and-validating-manually" class="tsd-anchor-link">Parsing and Validating <code>text/cmcd</code> manually<a href="#parsing-and-validating-manually" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>validateCmcdEvents</code> function is designed to validate multi-line <code>text/cmcd</code> bodies directly. However, if you need to validate a single-line string, you can decode the CMCD string and validate the data manually (this is what <code>validateCmcdRequest</code> does internally).</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">decodeCmcd</span><span class="hl-1">, </span><span class="hl-4">validateCmcd</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Simulated POST body (text/cmcd)</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">body</span><span class="hl-1"> = </span><span class="hl-2">`e=ps,sid=&quot;session-1&quot;,ts=1700000000000,sta=p,v=2</span><br/><span class="hl-2">e=t,sid=&quot;session-1&quot;,ts=1700000001000,bl=(5000),v=2`</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Parse each line and validate</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">lines</span><span class="hl-1"> = </span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-0">split</span><span class="hl-1">(</span><span class="hl-2">&quot;</span><span class="hl-10">\n</span><span class="hl-2">&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">line</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-4">lines</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-0">decodeCmcd</span><span class="hl-1">(</span><span class="hl-4">line</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcd</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">, { </span><span class="hl-4">reportingMode:</span><span class="hl-1"> </span><span class="hl-2">&quot;event&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-1">	</span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">valid</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Invalid CMCD event:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">issues</span><span class="hl-1">);</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="validating-request-mode-data" class="tsd-anchor-link">Validating Request Mode Data<a href="#validating-request-mode-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>In request mode, CMCD data is attached to segment requests via query parameters or HTTP headers. The validator ensures that event-only and response-only keys are not present.</p>
<h3 id="using-1" class="tsd-anchor-link">Using <code>validateCmcdRequest</code><a href="#using-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>validateCmcdRequest</code> function accepts a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request"><code>Request</code></a> object or an <code>HttpRequest</code> object from <code>@svta/cml-utils</code>. It checks for CMCD headers first — if any CMCD header shards are found, it delegates to <code>validateCmcdHeaders</code> for shard-placement verification. Otherwise, it extracts the <code>CMCD</code> query parameter from the URL.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcdRequest</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// From a Request with CMCD headers</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Request</span><span class="hl-1">(</span><span class="hl-2">&quot;https://cdn.example.com/seg.mp4&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">	</span><span class="hl-4">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-2">&quot;CMCD-Object&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;br=5000,d=4000,ot=v&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-2">&quot;CMCD-Request&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;bl=25000&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-2">&quot;CMCD-Session&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&#39;sid=&quot;abc&quot;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">});</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">headerResult</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdRequest</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// From a Request with CMCD in the query parameter</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">queryRequest</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Request</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-2">&quot;https://cdn.example.com/seg.mp4?CMCD=br%3D5000%2Cbl%3D25000&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">queryResult</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdRequest</span><span class="hl-1">(</span><span class="hl-4">queryRequest</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// From an HttpRequest object</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">httpRequestResult</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdRequest</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://cdn.example.com/seg.mp4?CMCD=br%3D5000%2Cbl%3D25000&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="from-query-parameters-manually" class="tsd-anchor-link">From Query Parameters manually<a href="#from-query-parameters-manually" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>validateCmcdRequest</code> function is designed to validate the <code>CMCD</code> query parameter from the URL. However, if you need to validate the <code>CMCD</code> query parameter manually, you can extract it from the URL and validate the data using the <code>validateCmcd</code> function.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">fromCmcdQuery</span><span class="hl-1">, </span><span class="hl-4">validateCmcd</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Extract CMCD from a request URL&#39;s query string</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">url</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-2">&quot;https://cdn.example.com/seg.mp4?CMCD=br%3D5000%2Cbl%3D25000%2Cd%3D4000%2Cot%3Dv%2Csid%3D%22abc%22&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-0">fromCmcdQuery</span><span class="hl-1">(</span><span class="hl-4">url</span><span class="hl-1">.</span><span class="hl-4">searchParams</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcd</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">, { </span><span class="hl-4">reportingMode:</span><span class="hl-1"> </span><span class="hl-2">&quot;request&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">valid</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Invalid CMCD request data:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">issues</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="from-http-headers-manually" class="tsd-anchor-link">From HTTP Headers manually<a href="#from-http-headers-manually" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When CMCD is transmitted via HTTP headers, you can validate the headers manually using the <code>validateCmcdHeaders</code> function.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcdHeaders</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Pass raw header strings directly — decoding is handled internally.</span><br/><span class="hl-8">// Request mode validation is applied automatically since headers are</span><br/><span class="hl-8">// only used in request mode.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdHeaders</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">&quot;CMCD-Object&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;br=5000,d=4000,ot=v&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">&quot;CMCD-Request&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;bl=25000&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">&quot;CMCD-Session&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&#39;sid=&quot;abc&quot;,sf=d,st=v&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">valid</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-8">// Issues may include shard placement errors and/or payload validation errors</span><br/><span class="hl-1">	</span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Validation issues:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">issues</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="version-aware-validation" class="tsd-anchor-link">Version-Aware Validation<a href="#version-aware-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The validators automatically detect the CMCD version from the <code>v</code> key in the payload. If <code>v</code> is absent, version 1 is assumed per the spec. You can override this with the <code>version</code> option.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcd</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Version inferred from payload (v=2)</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">v2Result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcd</span><span class="hl-1">({ </span><span class="hl-4">v:</span><span class="hl-1"> </span><span class="hl-7">2</span><span class="hl-1">, </span><span class="hl-4">br:</span><span class="hl-1"> [</span><span class="hl-7">5000</span><span class="hl-1">], </span><span class="hl-4">sid:</span><span class="hl-1"> </span><span class="hl-2">&quot;abc&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-8">// Version explicitly set via options</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">v1Result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcd</span><span class="hl-1">({ </span><span class="hl-4">br:</span><span class="hl-1"> </span><span class="hl-7">5000</span><span class="hl-1">, </span><span class="hl-4">sid:</span><span class="hl-1"> </span><span class="hl-2">&quot;abc&quot;</span><span class="hl-1"> }, { </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-7">1</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<h3 id="version-specific-behavior" class="tsd-anchor-link">Version-Specific Behavior<a href="#version-specific-behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Key validation</strong>: v2-only keys (e.g., <code>sta</code>, <code>ec</code>, <code>ab</code>) are rejected when validating as v1</li>
<li><strong>Type validation</strong>: Some keys have different types between versions. For example, <code>bl</code> is an integer in v1 but an inner list (array) in v2</li>
<li><strong>Version key</strong>: v2 payloads must include the <code>v</code> key; v1 payloads should omit it</li>
</ul>
<h2 id="handling-validation-results" class="tsd-anchor-link">Handling Validation Results<a href="#handling-validation-results" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="errors-vs-warnings" class="tsd-anchor-link">Errors vs Warnings<a href="#errors-vs-warnings" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A payload is considered <code>valid</code> if it contains zero errors. Warnings indicate spec recommendations that are not strict violations.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcd</span><span class="hl-1">, </span><span class="hl-4">CMCD_VALIDATION_SEVERITY_ERROR</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcd</span><span class="hl-1">({ </span><span class="hl-4">v:</span><span class="hl-1"> </span><span class="hl-7">2</span><span class="hl-1">, </span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-7">150</span><span class="hl-1">], </span><span class="hl-4">sid:</span><span class="hl-1"> </span><span class="hl-2">&quot;abc&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-8">// Separate errors from warnings</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">errors</span><span class="hl-1"> = </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">issues</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><br/><span class="hl-1">	(</span><span class="hl-4">i</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1">.</span><span class="hl-4">severity</span><span class="hl-1"> === </span><span class="hl-6">CMCD_VALIDATION_SEVERITY_ERROR</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">warnings</span><span class="hl-1"> = </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">issues</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><br/><span class="hl-1">	(</span><span class="hl-4">i</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1">.</span><span class="hl-4">severity</span><span class="hl-1"> !== </span><span class="hl-6">CMCD_VALIDATION_SEVERITY_ERROR</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Valid: </span><span class="hl-5">${</span><span class="hl-4">result</span><span class="hl-11">.</span><span class="hl-4">valid</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Errors: </span><span class="hl-5">${</span><span class="hl-4">errors</span><span class="hl-11">.</span><span class="hl-4">length</span><span class="hl-5">}</span><span class="hl-2">, Warnings: </span><span class="hl-5">${</span><span class="hl-4">warnings</span><span class="hl-11">.</span><span class="hl-4">length</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// bl=150 produces a warning (should be rounded to nearest 100)</span><br/><span class="hl-8">// but the payload is still valid</span>
</code><button type="button">Copy</button></pre>

<h3 id="logging-issues" class="tsd-anchor-link">Logging Issues<a href="#logging-issues" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcdEvents</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">validateAndLog</span><span class="hl-1">(</span><span class="hl-4">body</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdEvents</span><span class="hl-1">(</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><br/><span class="hl-1">	</span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">issue</span><span class="hl-1"> </span><span class="hl-5">of</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">issues</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">level</span><span class="hl-1"> = </span><span class="hl-4">issue</span><span class="hl-1">.</span><span class="hl-4">severity</span><span class="hl-1"> === </span><span class="hl-2">&quot;error&quot;</span><span class="hl-1"> ? </span><span class="hl-2">&quot;ERROR&quot;</span><span class="hl-1"> : </span><span class="hl-2">&quot;WARN&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">		</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">key</span><span class="hl-1"> = </span><span class="hl-4">issue</span><span class="hl-1">.</span><span class="hl-4">key</span><span class="hl-1"> ? </span><span class="hl-2">`[</span><span class="hl-5">${</span><span class="hl-4">issue</span><span class="hl-11">.</span><span class="hl-4">key</span><span class="hl-5">}</span><span class="hl-2">] `</span><span class="hl-1"> : </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">		</span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">level</span><span class="hl-5">}</span><span class="hl-2">: </span><span class="hl-5">${</span><span class="hl-4">key</span><span class="hl-5">}${</span><span class="hl-4">issue</span><span class="hl-11">.</span><span class="hl-4">message</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">	}</span><br/><br/><span class="hl-1">	</span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">valid</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="custom-keys" class="tsd-anchor-link">Custom Keys<a href="#custom-keys" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Custom keys (keys containing a hyphen, e.g., <code>com.example-mykey</code>) are recognized by all validators:</p>
<ul>
<li><code>validateCmcdKeys</code> — accepts custom keys without error</li>
<li><code>validateCmcdValues</code> — checks that custom key values are strings with a max length of 64 characters, and that the key name contains a hyphen</li>
<li><code>validateCmcdHeaders</code> — allows custom keys in any header shard</li>
</ul>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">validateCmcdValues</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">validateCmcdValues</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">&quot;com.example-debug&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;enabled&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">&quot;x-player-version&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;2.1.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// result.valid === true</span>
</code><button type="button">Copy</button></pre>

<h2 id="references" class="tsd-anchor-link">References<a href="#references" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="https://cta-wave.github.io/Resources/common-media-client-data--cta-5004-a.html">CTA-5004-A: Common Media Client Data v2</a></li>
<li><a href="https://cdn.cta.tech/cta/media/media/resources/standards/pdfs/cta-5004-final.pdf">CTA-5004: Common Media Client Data v1 (PDF)</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#cmcd-validation-guide"><span>CMCD <wbr/>Validation <wbr/>Guide</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#validating-event-report-payloads"><span>Validating <wbr/>Event <wbr/>Report <wbr/>Payloads</span></a></li><li><ul><li><a href="#using"><span>Using </span></a></li><li><a href="#parsing-and-validating-manually"><span>Parsing and <wbr/>Validating  manually</span></a></li></ul></li><li><a href="#validating-request-mode-data"><span>Validating <wbr/>Request <wbr/>Mode <wbr/>Data</span></a></li><li><ul><li><a href="#using-1"><span>Using </span></a></li><li><a href="#from-query-parameters-manually"><span>From <wbr/>Query <wbr/>Parameters manually</span></a></li><li><a href="#from-http-headers-manually"><span>From <wbr/>HTTP <wbr/>Headers manually</span></a></li></ul></li><li><a href="#version-aware-validation"><span>Version-<wbr/>Aware <wbr/>Validation</span></a></li><li><ul><li><a href="#version-specific-behavior"><span>Version-<wbr/>Specific <wbr/>Behavior</span></a></li></ul></li><li><a href="#handling-validation-results"><span>Handling <wbr/>Validation <wbr/>Results</span></a></li><li><ul><li><a href="#errors-vs-warnings"><span>Errors vs <wbr/>Warnings</span></a></li><li><a href="#logging-issues"><span>Logging <wbr/>Issues</span></a></li></ul></li><li><a href="#custom-keys"><span>Custom <wbr/>Keys</span></a></li><li><a href="#references"><span>References</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">CML</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer></footer><div class="overlay"></div></body></html>

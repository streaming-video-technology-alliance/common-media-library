<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>User Guide | CML</title><link rel="icon" href="../assets/favicon.png" type="image/png"/><meta name="description" content="Documentation for CML"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">CML</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="../modules/_svta_cml-cmcd.html">@svta/cml-cmcd</a></li><li><a href="" aria-current="page">User Guide</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="cmcd-user-guide" class="tsd-anchor-link">CMCD User Guide<a href="#cmcd-user-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>CmcdReporter</code> class provides a centralized way to manage CMCD (Common Media Client Data) reporting in a video player. It handles both request-mode reporting (adding CMCD data to segment requests) and event-mode reporting (sending periodic reports to analytics endpoints).</p>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@svta/cml-cmcd</span>
</code><button type="button">Copy</button></pre>

<h2 id="basic-usage" class="tsd-anchor-link">Basic Usage<a href="#basic-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="instantiating-the-reporter" class="tsd-anchor-link">Instantiating the Reporter<a href="#instantiating-the-reporter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Create a new <code>CmcdReporter</code> instance with configuration options:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-4">CmcdReporter</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">CmcdEventType</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">CMCD_QUERY</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">CMCD_V2</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-8">// Optional: Provide a content ID for the current asset</span><br/><span class="hl-1">	</span><span class="hl-4">cid:</span><span class="hl-1"> </span><span class="hl-2">&quot;content-12345&quot;</span><span class="hl-1">,</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Optional: Provide a session ID (auto-generated if not provided)</span><br/><span class="hl-1">	</span><span class="hl-4">sid:</span><span class="hl-1"> </span><span class="hl-2">&quot;session-abc-123&quot;</span><span class="hl-1">,</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Optional: CMCD version (defaults to CMCD_V2)</span><br/><span class="hl-1">	</span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-6">CMCD_V2</span><span class="hl-1">,</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Optional: Transmission mode for request reports (defaults to &#39;query&#39;)</span><br/><span class="hl-1">	</span><span class="hl-4">transmissionMode:</span><span class="hl-1"> </span><span class="hl-6">CMCD_QUERY</span><span class="hl-1">,</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Optional: Keys to include in request reports (if not provided, request reporting is disabled)</span><br/><span class="hl-1">	</span><span class="hl-4">enabledKeys:</span><span class="hl-1"> [</span><span class="hl-2">&quot;br&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;bl&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;d&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ot&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;sid&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;cid&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;mtp&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;sf&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;st&quot;</span><span class="hl-1">],</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Event reporting targets</span><br/><span class="hl-1">	</span><span class="hl-4">eventTargets:</span><span class="hl-1"> [</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://analytics.example.com/cmcd&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-8">// The events to report. If not provided, the event target is disabled.</span><br/><span class="hl-1">			</span><span class="hl-4">events:</span><span class="hl-1"> [</span><br/><span class="hl-1">				</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">PLAY_STATE</span><span class="hl-1">,</span><br/><span class="hl-1">				</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">ERROR</span><span class="hl-1">,</span><br/><span class="hl-1">				</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">TIME_INTERVAL</span><span class="hl-1">,</span><br/><span class="hl-1">			],</span><br/><span class="hl-1">			</span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-7">30</span><span class="hl-1">, </span><span class="hl-8">// seconds between TIME_INTERVAL reports</span><br/><span class="hl-1">			</span><span class="hl-4">batchSize:</span><span class="hl-1"> </span><span class="hl-7">5</span><span class="hl-1">, </span><span class="hl-8">// number of events to batch before sending</span><br/><span class="hl-1">			</span><span class="hl-4">enabledKeys:</span><span class="hl-1"> [</span><span class="hl-2">&quot;br&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;bl&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;sid&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;cid&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="minimal-configuration" class="tsd-anchor-link">Minimal Configuration<a href="#minimal-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For basic request-mode reporting without event reporting:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdReporter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">cid:</span><span class="hl-1"> </span><span class="hl-2">&quot;my-video-id&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<div class="tsd-alert tsd-alert-note"><div class="tsd-alert-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="../assets/icons.svg#icon-alertNote"></use></svg><span>Note</span></div><p>
The library defaults to the latest CMCD version (<code>CMCD_V2</code>). When upgrading the library, if you need to maintain compatibility with an older CMCD version, explicitly set the <code>version</code> option (e.g., <code>version: CMCD_V1</code>).</p>
</div>
<h2 id="setting-cmcd-data" class="tsd-anchor-link">Setting CMCD Data<a href="#setting-cmcd-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Use the <code>update()</code> method to set or update CMCD data. The reporter maintains an internal state that is applied to all subsequent requests and events.</p>
<pre><code class="typescript"><span class="hl-8">// Update multiple fields at once</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">br:</span><span class="hl-1"> [</span><span class="hl-7">5000</span><span class="hl-1">], </span><span class="hl-8">// Encoded bitrate (kbps)</span><br/><span class="hl-1">	</span><span class="hl-4">d:</span><span class="hl-1"> </span><span class="hl-7">4000</span><span class="hl-1">, </span><span class="hl-8">// Segment duration (ms)</span><br/><span class="hl-1">	</span><span class="hl-4">ot:</span><span class="hl-1"> </span><span class="hl-2">&quot;v&quot;</span><span class="hl-1">, </span><span class="hl-8">// Object type: video</span><br/><span class="hl-1">	</span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-7">25000</span><span class="hl-1">], </span><span class="hl-8">// Buffer length (ms)</span><br/><span class="hl-1">	</span><span class="hl-4">mtp:</span><span class="hl-1"> [</span><span class="hl-7">12000</span><span class="hl-1">], </span><span class="hl-8">// Measured throughput (kbps)</span><br/><span class="hl-1">	</span><span class="hl-4">sf:</span><span class="hl-1"> </span><span class="hl-2">&quot;d&quot;</span><span class="hl-1">, </span><span class="hl-8">// Streaming format: DASH</span><br/><span class="hl-1">	</span><span class="hl-4">st:</span><span class="hl-1"> </span><span class="hl-2">&quot;v&quot;</span><span class="hl-1">, </span><span class="hl-8">// Stream type: VOD</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Update individual fields as playback state changes</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-7">30000</span><span class="hl-1">] }); </span><span class="hl-8">// Buffer increased</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">pr:</span><span class="hl-1"> </span><span class="hl-7">1.5</span><span class="hl-1"> }); </span><span class="hl-8">// Playback rate changed</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">bs:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> }); </span><span class="hl-8">// Buffer starvation occurred</span>
</code><button type="button">Copy</button></pre>

<div class="tsd-alert tsd-alert-note"><div class="tsd-alert-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="../assets/icons.svg#icon-alertNote"></use></svg><span>Note</span></div><p>
In CMCD v2, several keys that were previously plain numbers are now typed as <code>CmcdObjectTypeList</code> â€” an inner list that supports per-object-type annotations. Keys like <code>br</code>, <code>bl</code>, <code>mtp</code>, <code>tb</code>, <code>lb</code>, <code>ab</code>, <code>tab</code>, <code>lab</code>, <code>tbl</code>, <code>pb</code>, <code>bsa</code>, <code>bsd</code>, <code>bsda</code>, and <code>tpb</code> must be passed as arrays (e.g., <code>br: [5000]</code>).</p>
</div>
<h3 id="value-formatting" class="tsd-anchor-link">Value Formatting<a href="#value-formatting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The CMCD specification requires certain keys to be formatted before transmission. The <code>CmcdReporter</code> handles this automatically, so always pass raw, unformatted values in their base units. Do not round or truncate values yourself. For example, pass the exact buffer length in milliseconds:</p>
<pre><code class="typescript"><span class="hl-8">// Correct: pass the raw value, the reporter rounds to nearest 100</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-7">25432</span><span class="hl-1">] }); </span><span class="hl-8">// encoded as bl=(25400)</span><br/><br/><span class="hl-8">// Incorrect: do not pre-round the value</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-7">25400</span><span class="hl-1">] });</span>
</code><button type="button">Copy</button></pre>

<h3 id="parameterized-values-with-tocmcdvalue" class="tsd-anchor-link">Parameterized Values with toCmcdValue<a href="#parameterized-values-with-tocmcdvalue" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Some CMCD keys like <code>nor</code> (next object request) and <code>br</code> (encoded bitrate) support parameterized values in CMCD v2. Use the <code>toCmcdValue</code> helper function to attach parameters to values:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdReporter</span><span class="hl-1">, </span><span class="hl-4">toCmcdValue</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">cid:</span><span class="hl-1"> </span><span class="hl-2">&quot;video-123&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Using toCmcdValue to add byte-range parameters to next object requests</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">nor:</span><span class="hl-1"> [</span><br/><span class="hl-1">		</span><span class="hl-0">toCmcdValue</span><span class="hl-1">(</span><span class="hl-2">&quot;segment_002.m4s&quot;</span><span class="hl-1">, { </span><span class="hl-4">r:</span><span class="hl-1"> </span><span class="hl-2">&quot;0-50000&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">		</span><span class="hl-0">toCmcdValue</span><span class="hl-1">(</span><span class="hl-2">&quot;segment_003.m4s&quot;</span><span class="hl-1">, { </span><span class="hl-4">r:</span><span class="hl-1"> </span><span class="hl-2">&quot;0-50000&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// This encodes to: nor=(&quot;segment_002.m4s&quot;;r=&quot;0-50000&quot; &quot;segment_003.m4s&quot;;r=&quot;0-50000&quot;)</span>
</code><button type="button">Copy</button></pre>

<p>The <code>toCmcdValue</code> utility accepts two arguments:</p>
<ol>
<li><strong>value</strong> - The bare item value (string, number, boolean, etc.)</li>
<li><strong>params</strong> - An object containing key-value pairs for parameters</li>
</ol>
<pre><code class="typescript"><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">nor:</span><span class="hl-1"> [</span><br/><span class="hl-1">		</span><span class="hl-0">toCmcdValue</span><span class="hl-1">(</span><span class="hl-2">&quot;seg1.m4s&quot;</span><span class="hl-1">, { </span><span class="hl-4">r:</span><span class="hl-1"> </span><span class="hl-2">&quot;0-5000&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">		</span><span class="hl-0">toCmcdValue</span><span class="hl-1">(</span><span class="hl-2">&quot;seg1.m4s&quot;</span><span class="hl-1">, { </span><span class="hl-4">r:</span><span class="hl-1"> </span><span class="hl-2">&quot;5000-10000&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// This encodes to: nor=(&quot;seg1.m4s&quot;;r=&quot;0-5000&quot; &quot;seg1.m4s&quot;;r=&quot;5000-10000&quot;)</span>
</code><button type="button">Copy</button></pre>

<p>Many keys allow for a list of numeric values with an associated object type, represented by a boolean flag.</p>
<pre><code class="typescript"><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">br:</span><span class="hl-1"> [</span><span class="hl-0">toCmcdValue</span><span class="hl-1">(</span><span class="hl-7">5000</span><span class="hl-1">, { </span><span class="hl-4">v:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> }), </span><span class="hl-0">toCmcdValue</span><span class="hl-1">(</span><span class="hl-7">3000</span><span class="hl-1">, { </span><span class="hl-4">a:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> })],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// This encodes to: br=(5000;v 3000;a)</span>
</code><button type="button">Copy</button></pre>

<h2 id="recording-events" class="tsd-anchor-link">Recording Events<a href="#recording-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Use the <code>recordEvent()</code> method to record player events for event-mode reporting. The second argument is an optional object of data to include in the event report:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdEventType</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Persistent data should be updated using `update()` before recording events</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">sta:</span><span class="hl-1"> </span><span class="hl-2">&quot;p&quot;</span><span class="hl-1"> });</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">recordEvent</span><span class="hl-1">(</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">PLAY_STATE</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Event specific data should be passed as the second argument to `recordEvent()`</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">recordEvent</span><span class="hl-1">(</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">CUSTOM_EVENT</span><span class="hl-1">, { </span><span class="hl-4">cen:</span><span class="hl-1"> </span><span class="hl-2">&quot;custom-event-name&quot;</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<h3 id="recording-response-received-events" class="tsd-anchor-link">Recording Response Received Events<a href="#recording-response-received-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>recordResponseReceived()</code> method provides a convenient way to record <code>RESPONSE_RECEIVED</code> events with automatic derivation of timing metrics from the HTTP response. This method is typically called after a segment request completes.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdReporter</span><span class="hl-1">, </span><span class="hl-4">CmcdEventType</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">cid:</span><span class="hl-1"> </span><span class="hl-2">&quot;video-123&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">enabledKeys:</span><span class="hl-1"> [</span><span class="hl-2">&quot;br&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;d&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ot&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;rc&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ttfb&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ttlb&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">	</span><span class="hl-4">eventTargets:</span><span class="hl-1"> [</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://analytics.example.com/cmcd&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-4">events:</span><span class="hl-1"> [</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">RESPONSE_RECEIVED</span><span class="hl-1">],</span><br/><span class="hl-1">			</span><span class="hl-4">enabledKeys:</span><span class="hl-1"> [</span><span class="hl-2">&quot;url&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;rc&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ttfb&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ttlb&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;br&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;d&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ot&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h4 id="basic-usage-1" class="tsd-anchor-link">Basic Usage<a href="#basic-usage-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The method accepts a <code>CommonMediaResponse</code> object and automatically derives the following keys:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td>The requested URL (without CMCD)</td>
<td><code>response.request.url</code> (CMCD query param stripped)</td>
</tr>
<tr>
<td><code>rc</code></td>
<td>HTTP response status code</td>
<td><code>response.status</code></td>
</tr>
<tr>
<td><code>ts</code></td>
<td>Request initiation timestamp</td>
<td><code>response.resourceTiming.startTime</code></td>
</tr>
<tr>
<td><code>ttfb</code></td>
<td>Time to first byte (ms)</td>
<td><code>responseStart - startTime</code></td>
</tr>
<tr>
<td><code>ttlb</code></td>
<td>Time to last byte (ms)</td>
<td><code>response.resourceTiming.duration</code></td>
</tr>
</tbody>
</table>
<pre><code class="typescript"><span class="hl-8">// After receiving a response</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">200</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">request:</span><span class="hl-1"> </span><span class="hl-4">decoratedRequest</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">resourceTiming:</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-4">startTime:</span><span class="hl-1"> </span><span class="hl-4">performance</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">(),</span><br/><span class="hl-1">		</span><span class="hl-4">responseStart:</span><span class="hl-1"> </span><span class="hl-4">performance</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() + </span><span class="hl-7">50</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">duration:</span><span class="hl-1"> </span><span class="hl-7">150</span><span class="hl-1">,</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">recordResponseReceived</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h4 id="complete-requestresponse-flow" class="tsd-anchor-link">Complete Request/Response Flow<a href="#complete-requestresponse-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>For full request/response tracking, use <code>createRequestReport()</code> before the request and <code>recordResponseReceived()</code> after the response. The CMCD data from the original request is automatically included in the response event:</p>
<pre><code class="typescript"><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">fetchSegment</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-4">url</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">segmentInfo</span><span class="hl-1">: </span><span class="hl-9">SegmentInfo</span><span class="hl-1">,</span><br/><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">ArrayBuffer</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">	</span><span class="hl-8">// Update player state</span><br/><span class="hl-1">	</span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">		</span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">getBufferLength</span><span class="hl-1">()],</span><br/><span class="hl-1">		</span><span class="hl-4">mtp:</span><span class="hl-1"> [</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">getMeasuredThroughput</span><span class="hl-1">()],</span><br/><span class="hl-1">	});</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Decorate the request with CMCD data</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1"> = </span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">createRequestReport</span><span class="hl-1">(</span><br/><span class="hl-1">		{ </span><span class="hl-4">url</span><span class="hl-1">, </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;GET&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-4">br:</span><span class="hl-1"> [</span><span class="hl-4">segmentInfo</span><span class="hl-1">.</span><span class="hl-4">bitrate</span><span class="hl-1">],</span><br/><span class="hl-1">			</span><span class="hl-4">d:</span><span class="hl-1"> </span><span class="hl-4">segmentInfo</span><span class="hl-1">.</span><span class="hl-4">duration</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-4">ot:</span><span class="hl-1"> </span><span class="hl-4">segmentInfo</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1">,</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	);</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Fetch the segment and capture timing</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">startTime</span><span class="hl-1"> = </span><span class="hl-4">performance</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">url</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">responseStart</span><span class="hl-1"> = </span><span class="hl-4">performance</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">buffer</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">arrayBuffer</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">duration</span><span class="hl-1"> = </span><span class="hl-4">performance</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-4">startTime</span><span class="hl-1">;</span><br/><br/><span class="hl-1">	</span><span class="hl-8">// Record the response received event</span><br/><span class="hl-1">	</span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">recordResponseReceived</span><span class="hl-1">({</span><br/><span class="hl-1">		</span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">request</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">resourceTiming:</span><span class="hl-1"> {</span><br/><span class="hl-1">			</span><span class="hl-4">startTime</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-4">responseStart</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-4">duration</span><span class="hl-1">,</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	});</span><br/><br/><span class="hl-1">	</span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">buffer</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h4 id="providing-additional-data" class="tsd-anchor-link">Providing Additional Data<a href="#providing-additional-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>You can supply additional CMCD keys that cannot be auto-derived, such as server-provided metrics:</p>
<pre><code class="typescript"><span class="hl-8">// Include server-reported metrics from response headers</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">serverDeliveryDuration</span><span class="hl-1"> = </span><span class="hl-0">parseFloat</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-4">fetchResponse</span><span class="hl-1">.</span><span class="hl-4">headers</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&quot;X-Server-Duration&quot;</span><span class="hl-1">) || </span><span class="hl-2">&quot;0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">recordResponseReceived</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">, {</span><br/><span class="hl-1">	</span><span class="hl-4">ttfbb:</span><span class="hl-1"> </span><span class="hl-7">25</span><span class="hl-1">, </span><span class="hl-8">// Time to first body byte (player-measured)</span><br/><span class="hl-1">	</span><span class="hl-4">cmsdd:</span><span class="hl-1"> </span><span class="hl-4">serverDeliveryDuration</span><span class="hl-1">, </span><span class="hl-8">// CMS delivery duration (from server)</span><br/><span class="hl-1">	</span><span class="hl-4">cmsds:</span><span class="hl-1"> </span><span class="hl-7">1500</span><span class="hl-1">, </span><span class="hl-8">// CMS delivery speed (from server)</span><br/><span class="hl-1">	</span><span class="hl-4">smrt:</span><span class="hl-1"> </span><span class="hl-7">2000</span><span class="hl-1">, </span><span class="hl-8">// Server measured round-trip time (from server)</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Values provided in the <code>data</code> parameter override any auto-derived values.</p>
<h2 id="decorating-segment-requests" class="tsd-anchor-link">Decorating Segment Requests<a href="#decorating-segment-requests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Use the <code>createRequestReport()</code> method to add CMCD data to segment requests. This method returns a new request object with CMCD data added via query parameters or headers (depending on configuration).</p>
<h3 id="query-parameter-mode-default" class="tsd-anchor-link">Query Parameter Mode (Default)<a href="#query-parameter-mode-default" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdReporter</span><span class="hl-1">, </span><span class="hl-4">CMCD_QUERY</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">transmissionMode:</span><span class="hl-1"> </span><span class="hl-6">CMCD_QUERY</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Update CMCD data before the request</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">br:</span><span class="hl-1"> [</span><span class="hl-7">5000</span><span class="hl-1">],</span><br/><span class="hl-1">	</span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-7">25000</span><span class="hl-1">],</span><br/><span class="hl-1">	</span><span class="hl-4">d:</span><span class="hl-1"> </span><span class="hl-7">4000</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">ot:</span><span class="hl-1"> </span><span class="hl-2">&quot;v&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Create the original request</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://cdn.example.com/video/segment_001.m4s&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;GET&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">headers:</span><span class="hl-1"> {},</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-8">// Create the decorated request</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">decoratedRequest</span><span class="hl-1"> = </span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">createRequestReport</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Use the decorated request with your HTTP client</span><br/><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-4">decoratedRequest</span><span class="hl-1">.</span><span class="hl-4">url</span><span class="hl-1">, </span><span class="hl-4">decoratedRequest</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="headers-mode" class="tsd-anchor-link">Headers Mode<a href="#headers-mode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdReporter</span><span class="hl-1">, </span><span class="hl-4">CMCD_HEADERS</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">transmissionMode:</span><span class="hl-1"> </span><span class="hl-6">CMCD_HEADERS</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">br:</span><span class="hl-1"> [</span><span class="hl-7">5000</span><span class="hl-1">],</span><br/><span class="hl-1">	</span><span class="hl-4">bl:</span><span class="hl-1"> [</span><span class="hl-7">25000</span><span class="hl-1">],</span><br/><span class="hl-1">	</span><span class="hl-4">d:</span><span class="hl-1"> </span><span class="hl-7">4000</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://cdn.example.com/video/segment_001.m4s&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;GET&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">headers:</span><span class="hl-1"> {},</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">decoratedRequest</span><span class="hl-1"> = </span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">createRequestReport</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">, { </span><span class="hl-4">ot:</span><span class="hl-1"> </span><span class="hl-2">&quot;v&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-8">// decoratedRequest.headers will contain:</span><br/><span class="hl-8">// {</span><br/><span class="hl-8">//   &#39;CMCD-Object&#39;: &#39;br=(5000),d=4000,ot=v&#39;,</span><br/><span class="hl-8">//   &#39;CMCD-Request&#39;: &#39;bl=(25000)&#39;,</span><br/><span class="hl-8">// }</span>
</code><button type="button">Copy</button></pre>

<h2 id="lifecycle-management" class="tsd-anchor-link">Lifecycle Management<a href="#lifecycle-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="starting-the-reporter" class="tsd-anchor-link">Starting the Reporter<a href="#starting-the-reporter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Call <code>start()</code> to begin automatic <code>TIME_INTERVAL</code> event reporting:</p>
<pre><code class="typescript"><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>This starts an interval timer that automatically records <code>TIME_INTERVAL</code> events based on the configured interval.</p>
<h3 id="stopping-the-reporter" class="tsd-anchor-link">Stopping the Reporter<a href="#stopping-the-reporter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Call <code>stop()</code> to stop automatic reporting:</p>
<pre><code class="typescript"><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h3 id="flushing-events" class="tsd-anchor-link">Flushing Events<a href="#flushing-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Call <code>flush()</code> to immediately send all queued events, regardless of batch size:</p>
<pre><code class="typescript"><span class="hl-8">// Send all pending events (useful when playback ends)</span><br/><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">flush</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h3 id="complete-lifecycle-example" class="tsd-anchor-link">Complete Lifecycle Example<a href="#complete-lifecycle-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">cid:</span><span class="hl-1"> </span><span class="hl-2">&quot;video-123&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">eventTargets:</span><span class="hl-1"> [</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://analytics.example.com/cmcd&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-4">events:</span><span class="hl-1"> [</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">TIME_INTERVAL</span><span class="hl-1">, </span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">PLAY_STATE</span><span class="hl-1">],</span><br/><span class="hl-1">			</span><span class="hl-4">interval:</span><span class="hl-1"> </span><span class="hl-7">30</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-4">batchSize:</span><span class="hl-1"> </span><span class="hl-7">3</span><span class="hl-1">,</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Start reporting when playback begins</span><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">onPlaybackStart</span><span class="hl-1">() {</span><br/><span class="hl-1">	</span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">// Stop reporting and flush when playback ends</span><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">onPlaybackEnd</span><span class="hl-1">() {</span><br/><span class="hl-1">	</span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">flush</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">// Clean up when the player is destroyed</span><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">onPlayerDestroy</span><span class="hl-1">() {</span><br/><span class="hl-1">	</span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-4">reporter</span><span class="hl-1">.</span><span class="hl-0">flush</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="custom-http-client" class="tsd-anchor-link">Custom HTTP Client<a href="#custom-http-client" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>By default, <code>CmcdReporter</code> uses the native <code>fetch</code> API to send event reports. You can provide a custom requester function:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdReporter</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">customRequester</span><span class="hl-1"> = </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">request</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-8">// Use your preferred HTTP client</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">axios</span><span class="hl-1">({</span><br/><span class="hl-1">		</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">url</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">method</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">headers:</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">headers</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">data:</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">,</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">	</span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1"> };</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">(</span><br/><span class="hl-1">	{</span><br/><span class="hl-1">		</span><span class="hl-4">cid:</span><span class="hl-1"> </span><span class="hl-2">&quot;video-123&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">eventTargets:</span><span class="hl-1"> [</span><br/><span class="hl-1">			{</span><br/><span class="hl-1">				</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://analytics.example.com/cmcd&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">				</span><span class="hl-4">events:</span><span class="hl-1"> [</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">TIME_INTERVAL</span><span class="hl-1">],</span><br/><span class="hl-1">			},</span><br/><span class="hl-1">		],</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	</span><span class="hl-4">customRequester</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h2 id="filtering-cmcd-keys" class="tsd-anchor-link">Filtering CMCD Keys<a href="#filtering-cmcd-keys" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can limit which CMCD keys are included in reports using the <code>enabledKeys</code> option:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">CmcdReporter</span><span class="hl-1">, </span><span class="hl-4">CMCD_KEYS</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@svta/cml-cmcd&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reporter</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CmcdReporter</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-4">cid:</span><span class="hl-1"> </span><span class="hl-2">&quot;video-123&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-8">// Only include these keys in request reports</span><br/><span class="hl-1">	</span><span class="hl-4">enabledKeys:</span><span class="hl-1"> [</span><span class="hl-2">&quot;br&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;bl&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;d&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;ot&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;sid&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;cid&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">	</span><span class="hl-4">eventTargets:</span><span class="hl-1"> [</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&quot;https://analytics.example.com/cmcd&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-4">events:</span><span class="hl-1"> [</span><span class="hl-4">CmcdEventType</span><span class="hl-1">.</span><span class="hl-6">TIME_INTERVAL</span><span class="hl-1">],</span><br/><span class="hl-1">			</span><span class="hl-8">// Override enabled keys for this specific target</span><br/><span class="hl-1">			</span><span class="hl-4">enabledKeys:</span><span class="hl-1"> [</span><span class="hl-2">&quot;br&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;bl&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;sid&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;cid&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<div class="tsd-alert tsd-alert-note"><div class="tsd-alert-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="../assets/icons.svg#icon-alertNote"></use></svg><span>Note</span></div><p>
Certain keys, such as <code>v</code> (version), are required by the CMCD specification and will always be included in reports regardless of the <code>enabledKeys</code> setting. The <code>enabledKeys</code> property cannot be used to disable these keys.</p>
</div>
<h2 id="configuration-reference" class="tsd-anchor-link">Configuration Reference<a href="#configuration-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="cmcdreporterconfig" class="tsd-anchor-link">CmcdReporterConfig<a href="#cmcdreporterconfig" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sid</code></td>
<td><code>string</code></td>
<td>Auto-generated UUID</td>
<td>Session ID</td>
</tr>
<tr>
<td><code>cid</code></td>
<td><code>string</code></td>
<td><code>undefined</code></td>
<td>Content ID</td>
</tr>
<tr>
<td><code>version</code></td>
<td><code>CmcdVersion</code></td>
<td><code>CMCD_V2</code></td>
<td>CMCD protocol version</td>
</tr>
<tr>
<td><code>transmissionMode</code></td>
<td><code>CmcdTransmissionMode</code></td>
<td><code>'query'</code></td>
<td>How to transmit CMCD data in request mode</td>
</tr>
<tr>
<td><code>enabledKeys</code></td>
<td><code>CmcdKey[]</code></td>
<td><code>undefined</code></td>
<td>Keys to include in request reports. If not provided, no keys will be reported.</td>
</tr>
<tr>
<td><code>eventTargets</code></td>
<td><code>CmcdEventReportConfig[]</code></td>
<td><code>[]</code></td>
<td>Event reporting targets</td>
</tr>
</tbody>
</table>
<h3 id="cmcdeventreportconfig" class="tsd-anchor-link">CmcdEventReportConfig<a href="#cmcdeventreportconfig" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td><code>string</code></td>
<td>Required</td>
<td>Analytics endpoint URL</td>
</tr>
<tr>
<td><code>events</code></td>
<td><code>CmcdEventType[]</code></td>
<td><code>undefined</code></td>
<td>Events to report. If no events are provided, the target is disabled.</td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>number</code></td>
<td><code>30</code></td>
<td>Seconds between TIME_INTERVAL reports</td>
</tr>
<tr>
<td><code>batchSize</code></td>
<td><code>number</code></td>
<td><code>1</code></td>
<td>Events to batch before sending</td>
</tr>
<tr>
<td><code>version</code></td>
<td><code>CmcdVersion</code></td>
<td><code>CMCD_V2</code></td>
<td>CMCD version for this target (must be v2 or higher)</td>
</tr>
<tr>
<td><code>enabledKeys</code></td>
<td><code>CmcdKey[]</code></td>
<td><code>undefined</code></td>
<td>Keys to include for this target. If not provided, no keys will be reported.</td>
</tr>
</tbody>
</table>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#cmcd-user-guide"><span>CMCD <wbr/>User <wbr/>Guide</span></a><ul><li><a href="#installation"><span>Installation</span></a></li><li><a href="#basic-usage"><span>Basic <wbr/>Usage</span></a></li><li><ul><li><a href="#instantiating-the-reporter"><span>Instantiating the <wbr/>Reporter</span></a></li><li><a href="#minimal-configuration"><span>Minimal <wbr/>Configuration</span></a></li></ul></li><li><a href="#setting-cmcd-data"><span>Setting <wbr/>CMCD <wbr/>Data</span></a></li><li><ul><li><a href="#value-formatting"><span>Value <wbr/>Formatting</span></a></li><li><a href="#parameterized-values-with-tocmcdvalue"><span>Parameterized <wbr/>Values with to<wbr/>Cmcd<wbr/>Value</span></a></li></ul></li><li><a href="#recording-events"><span>Recording <wbr/>Events</span></a></li><li><ul><li><a href="#recording-response-received-events"><span>Recording <wbr/>Response <wbr/>Received <wbr/>Events</span></a></li><li><ul><li><a href="#basic-usage-1"><span>Basic <wbr/>Usage</span></a></li><li><a href="#complete-requestresponse-flow"><span>Complete <wbr/>Request/<wbr/>Response <wbr/>Flow</span></a></li><li><a href="#providing-additional-data"><span>Providing <wbr/>Additional <wbr/>Data</span></a></li></ul></li></ul></li><li><a href="#decorating-segment-requests"><span>Decorating <wbr/>Segment <wbr/>Requests</span></a></li><li><ul><li><a href="#query-parameter-mode-default"><span>Query <wbr/>Parameter <wbr/>Mode (<wbr/>Default)</span></a></li><li><a href="#headers-mode"><span>Headers <wbr/>Mode</span></a></li></ul></li><li><a href="#lifecycle-management"><span>Lifecycle <wbr/>Management</span></a></li><li><ul><li><a href="#starting-the-reporter"><span>Starting the <wbr/>Reporter</span></a></li><li><a href="#stopping-the-reporter"><span>Stopping the <wbr/>Reporter</span></a></li><li><a href="#flushing-events"><span>Flushing <wbr/>Events</span></a></li><li><a href="#complete-lifecycle-example"><span>Complete <wbr/>Lifecycle <wbr/>Example</span></a></li></ul></li><li><a href="#custom-http-client"><span>Custom <wbr/>HTTP <wbr/>Client</span></a></li><li><a href="#filtering-cmcd-keys"><span>Filtering <wbr/>CMCD <wbr/>Keys</span></a></li><li><a href="#configuration-reference"><span>Configuration <wbr/>Reference</span></a></li><li><ul><li><a href="#cmcdreporterconfig"><span>Cmcd<wbr/>Reporter<wbr/>Config</span></a></li><li><a href="#cmcdeventreportconfig"><span>Cmcd<wbr/>Event<wbr/>Report<wbr/>Config</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">CML</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer></footer><div class="overlay"></div></body></html>

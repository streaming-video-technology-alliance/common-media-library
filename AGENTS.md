# Common Media Library AI Agent Instructions

## Project Overview

This is a monorepo containing multiple TypeScript libraries for media playback functionality. The libraries provide standardized implementations of media-related specifications like CMCD, CMSD, ID3, ISO BMFF, WebVTT, DASH, and more.

## Build Commands

- `npm run build -w <workspace>`: Build the a module
- `npm run typecheck`: Run the typechecker
- `npm test -w <workspace>`: Run the tests for a module
- `npm run format`: Run the formatter
- `npm run ver <package> <version>`: Update the version for a package. The package identifier is the name of the package folder minus the `libs/` prefix, e.g. `iso-bmff`. The version should be in semver format `x.x.x` or `x.x.x-alpha.x`.

## Code Style and Conventions

- Use TypeScript strict mode
- Use ES modules (import/export) syntax, not CommonJS (require)
- Destructure imports when possible (e.g., `import { foo } from 'bar'`)
- Follow existing naming conventions in the codebase
- Use TSDoc comments for public APIs

## Workflow

- Be sure to typecheck when youâ€™re done making a series of code changes
- Always run the typechecker against the entire project
- Prefer running builds and tests at the workspace level
- Always create tests for new members of a package's public API
- Always update the package's version in the package.json file using semantic versioning based on the changes made
- Always update the package's CHANGELOG.md when making changes
- When a package's version changes, always create a patch version change to any other packages that depend on it

## Documentation

- Use `{@includeCode ../test/<file>.test.ts#example}` in TSDoc to reference test examples
- Mark example regions in tests with `// #region example` and `// #endregion example`
- Public API changes are tracked in `config/cml-*.api.md` (regenerated by build)
- Use GitHub Flavored Markdown (GFM) for documentation.
- Package documentation is located in `<package>/docs/`

## Testing

- Tests are located in `<package>/test/`
- Test use the bundled module, not the source code, so build the necessary package before running tests
- Include an example test case with `#region example` for documentation purposes
- Run tests at workspace level: `npm test -w libs/<workspace>`

## Dependencies

- Node.js >= 20 required
- All packages use TypeScript 5.8+
- Uses npm workspaces for monorepo management

## Git Commit Guidelines

- **Always use `git commit -s`** to add the DCO sign-off (`Signed-off-by:` line). Every commit must have this.
- Follow the conventional commit format (e.g., `feat:`, `fix:`, `refactor:`, `chore:`).

## Important notes

- This is a standards-focused library - accuracy and spec compliance is critical

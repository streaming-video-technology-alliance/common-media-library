# GitHub Copilot Instructions for Common Media Library

## Project Overview

This is a monorepo containing multiple TypeScript libraries for media playback functionality. The libraries provide standardized implementations of media-related specifications like CMCD, CMSD, ID3, ISO BMFF, WebVTT, DASH, and more.

## Project Structure

- `libs/*` - Individual library packages published to npm under `@svta/cml-*` namespace
- `docs` - Documentation site published to GitHub Pages
- `dev` - Development workspace
- Each library has its own `src/`, `test/`, and `dist/` directories

## Build Commands

- `npm run build` - Build all libraries in the correct dependency order
- `npm run build -w libs/<workspace>` - Build a specific library (e.g., `libs/cmcd`)
- `npm run typecheck` - Run TypeScript type checker on entire project
- `npm test -w libs/<workspace>` - Run tests for a specific library
- `npm run format` - Run the formatter and auto-fix issues
- `npm run lint` - Run ESLint on the codebase

## Code Style and Conventions

- Use TypeScript strict mode
- Use ES modules (import/export) syntax, not CommonJS (require)
- Destructure imports when possible (e.g., `import { foo } from 'bar'`)
- Follow existing naming conventions in the codebase
- Use JSDoc/TSDoc comments for public APIs

## Development Workflow

1. **Type checking**: Always run the typechecker against the entire project when done making changes
2. **Building**: Prefer running builds at the workspace level. Tests use the bundled module (not source), so build before testing
3. **Testing**: Always create tests for new members of a package's public API
4. **Versioning**: 
   - Update package version in `package.json` using semantic versioning
   - Use `npm run ver <package> <version>` command (package is folder name without `libs/` prefix, version in `x.x.x` format)
   - When a package version changes, create patch version changes to dependent packages
5. **Documentation**: 
   - Update the package's CHANGELOG.md when making changes
   - Public API changes are tracked in `config/cml-*.api.md` (auto-regenerated by build)
   - Use `{@includeCode ../test/<file>.test.ts#example}` in TSDoc to reference test examples
   - Mark example regions in tests with `// #region example` and `// #endregion example`

## Testing

- Tests are located in `<package>/test/`
- Tests use the bundled module, not source code - always build before testing
- Include an example test case with `#region example` for documentation purposes
- Run tests at workspace level: `npm test -w libs/<workspace>`

## Git Commit Guidelines

- All commits must be signed off by the author (DCO)
- Follow conventional commit format (e.g., `feat:`, `fix:`, `docs:`, `chore:`)

## Dependencies

- Node.js >= 20 required
- All packages use TypeScript 5.8+
- Uses npm workspaces for monorepo management

## Important Notes

- This is a standards-focused library - accuracy and spec compliance is critical
- Changes should maintain backward compatibility where possible
- Consider impact on dependent packages when making changes
- The library is used by major open-source players (hls.js, dash.js, shaka-player)
